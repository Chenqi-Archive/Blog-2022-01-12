<html>
	<head>
		<link rel="icon" href="favicon.jpg" />
		<title>Chenqi's blog</title>
		<style>
			body {
				width: 98%;
				height: fit-content;
				margin: 0px auto;
				font-family: Segoe UI, DengXian;
				font-size: 18px;
				line-height: 1.6;
			}

			@media (min-width:900px) {
				body {
					width: 900px;
				}
			}
			
			#menu-bar {
				width: 100%;
				height: 40px;
				background-color: #d3ee90;
			}
			
			#title {
				text-align: center;
				padding: 5px;
			}
			
			#article-list {
				margin: 5px 0px;
			}
			
			#article-title {
				border: 1px solid #ddd;
				padding: 10px 10px;
				margin-bottom: -1px;
				font-size: 20px;
			}

			#article {
				border: 3px solid #ddd;
			    border-radius: 10px;
			    padding: 20px 50px 100px;
			    margin: 5px 0;
			}
		</style>
	</head>

	<body>
		<div id="menu-bar" onclick="show_or_hide_article_list()">
			<div id="title">Chenqi's blog</div>
		</div>
		<div id="article-list" onclick="open_article(event)"></div>
		<div id="article" style="display:none"></div>
		<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
		<script>
			obj_article_list = document.getElementById('article-list');
			obj_article = document.getElementById('article');
			current_article_title = '';
			req = new XMLHttpRequest();
			function load_file(file_path, on_success){
				req.onreadystatechange = function () {
					if (req.readyState == 4 && req.status == 200) { 
						on_success(req.responseText); 
					}
				};
				req.open('GET', file_path, true);
				req.send();
			}
			function load_article_list(){
				load_file('article_list.txt', function(response){
					var articles = response.split('\n');
					for(let i = 0; i < articles.length; i++){
						if(articles[i] == '') { continue; }
						let obj_article_title = document.createElement('div');
						obj_article_title.id = 'article-title';
						obj_article_title.innerText = articles[i];
						obj_article_list.appendChild(obj_article_title);
					}
				});
			}
			function load_article(article_title) {
				load_file('articles/' + article_title + '.md', function(response){
					obj_article.innerHTML = marked(response);
					obj_article.style.display = 'block';					
				});
				obj_article_list.style.display = 'none';
				current_article_title = article_title;
			}
			function open_article(event){
				if(event.target.id == 'article-title'){
					load_article(event.target.innerText);
					window.history.pushState({article_title:current_article_title}, current_article_title);
				}
			}
			function on_pop_state(event){
				if(event.state == null){
					obj_article_list.style.display = 'block';
					obj_article.style.display = 'none';
				}else{
					load_article(event.state.article_title);
				}
			}
			function show_or_hide_article_list(){
				if(obj_article_list.style.display == 'none'){
					obj_article_list.style.display = 'block';
				} else {
					obj_article_list.style.display = 'none';
				}
			}
			load_article_list();
			window.onpopstate = on_pop_state;
		</script>
	</body>
</html>