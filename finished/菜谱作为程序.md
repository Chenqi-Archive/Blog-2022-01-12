前几天在食堂吃早饭时突然意识到，做菜的过程完全就是一种计算：从食品原料出发，经过一系列预先定义的加工流程，最后得到成熟的菜品。数学表达式计算过程可以用有向无环图表示如下，菜谱应该也可以用类似的方法表达。

<img src="assets/register_allocation_on_dag/exp_example.png" height="200px">

<p class="caption">用有向无环图表示(a + b) * (-b)的计算过程</p>

我之所以会产生这个想法，或许受到了最近频繁出现在豆瓣推送中的炸厨房组的影响，又或者是源于微信公众号经常推送的做菜视频，也可能是受王垠最近发的几条关于做菜的微博的<a href="http://www.yinwang.org/blog-cn/2013/04/12/inspiration" target="_blank">启发</a>，我已经记不清了。

这个想法看上去很美妙。我从网上随便找了个菜谱作为例子，下面就来尝试一下：

<img src="https://bkimg.cdn.bcebos.com/pic/6159252dd42a28344b31ca7250b5c9ea15cebf30" height="400px">

<p class="caption">木须肉（图源百度百科，链接见下）</p>

> <a href="https://baike.baidu.com/item/木须肉/440282?fr=aladdin#2" target="_blank">【木须肉】百度百科</a>
>
> 1. 泡发木耳。提前将木耳泡在温水中直到泡发。
> 2. 将猪里脊肉切成片、木耳去掉根部撕成小块、黄瓜切片、鸡蛋打散、葱姜蒜切末备用。
> 3. 腌肉。往猪里脊肉内加入一勺料酒、一勺玉米淀粉、半个蛋清，然后抓匀腌制十分钟。
> 4. 锅中倒入适量的油，油热后倒入蛋液，小火将鸡蛋炒熟然后盛出备用。
> 5. 锅中再倒入少许油，油热后放入里脊肉快速滑开。
> 6. 待里脊肉颜色变白，放入葱姜蒜煸炒出香味。(肉不需要炒太久，变白即可。炒太久，口感就老了)
> 7. 将木耳放入锅中煸炒均匀后加热2分钟。然后放入1勺盐、2勺生抽调味。
> 8. 将黄瓜放入锅中煸炒均匀。
> 9. 将鸡蛋放入锅中煸炒均匀。然后在出锅前放少许鸡精和香油翻拌均匀即可。
>

（我本来打算选麻婆豆腐作为例子，但觉得有些简单，就换了这个稍微复杂一些的木须肉）

原文中的步骤使用序列表示（步骤1,2,...,9），但可以发现，有些步骤之间并没有严格的先后关系，比如步骤1泡发木耳、步骤3腌肉、步骤4炒鸡蛋的次序可以任意交换，步骤2中有很多小步骤，也可以拆开作为单独的步骤。整理之后，各个步骤大概呈现下面的依赖关系，可以用有向无环图表示：

<img src="assets/register_allocation_on_dag/cook.png" width="100%">

<p class="caption">用有向无环图表示木须肉的加工过程</p>

当然，很多细节信息，比如各种原材料的用量、放入的顺序、加工的时间等都没有呈现出来。

试着总结一下，做菜的过程和一般所说的计算机程序的运行虽然有诸多不同之处，比如：

- 程序是计算机解释运行的；菜谱是由人阅读并执行的。
- 程序中的一个变量可以被任意复制，多次使用；而食品原料用掉就没了，遵守物质守恒。
- 程序的运行可以暂停，之后继续运行不会影响计算结果；做菜的有些步骤无法中断，比如炒菜一旦开始就无法暂停。
- ……

但也有更多相似之处，比如：

- 程序的运行和做菜的过程都可以用上面的有向无环图表达。
- 程序运行过程中计算机的硬件结构不变，而数据不断流动变化；做菜过程中锅和勺子不变，而菜被炒熟了。
- 计算机硬件可以执行任意的程序；锅也可以用来炒任何一种菜。
- 程序的运行需要供电；菜炒熟的过程需要烧火供能。
- 程序可以复制；菜谱也可以复印。（注意在程序运行期间，某个变量可以复制；而做菜的过程中，菜不能被复制）
- ……

总之，广义来看，菜谱好像和程序没有太大区别。那么做菜的人或许和计算机也没有太大区别吧。

